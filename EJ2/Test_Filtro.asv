clear;
clc;
file = 'pcm mono 8 bit 32kHz.wav';
info = audioinfo(file);
[y,Fs] = audioread(file);
t = 0:seconds(1/Fs):seconds(info.Duration);
t = t(1:end);
data = y(:,1);
S = compand(data,255,max(data),'mu/compressor');
Noise = wgn(length(data),1,-60);
X_tot = S + Noise;


Stot = empty.double;
Muestras = 160;
for l=0:int(length(S)/Muestras)
    % td significa tiempo dis
    td = l*Offset:Muestras+l*Offset-1; % el -1 es para que tenga length = muestras

end

x = X_tot(td);
Rss = get_Rxx(S(td),Muestras);

%----------Lo que esta encerrado esta mal-----------------------
%Esta otra opción es con la Ec 7.18 de la Página 387
Rss_1_N = Rss(2:length(Rss));
Rss_0_N_menos_1 = Rss(1:length(Rss)-1); 
RssMat = toeplitz(Rss_0_N_menos_1);
h = (inv(RssMat))*Rss_1_N';
%----------------------------------------------------------------
%Shat la calculamos con la formula página 411 Shanmugan
Shat = conv(h,x,'same');

